<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalles del pedido</title>
    <link rel="stylesheet" th:href="@{/css/menu.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<div th:insert="fragments/general.html :: menu"></div>

<h2 style="text-align: center">Detalles del pedido:</h2>

<div>
    <h3>Detalles de envío</h3>
    Nombre completo: <span th:text="${pedido.nombreCompleto}"></span><br>
    Dirección: <span th:text="${pedido.direccion}"></span><br>
    Provincia: <span th:text="${pedido.provincia}"></span><br>
    Portal: <span th:text="${pedido.portal}"></span><br>
    Piso: <span th:text="${pedido.piso}"></span><br>
    Teléfono: <span th:text="${pedido.telefono}"></span><br>
</div>

<br>

<div>
    <h3>Datos de pago</h3>
    Tipo de tarjeta: <span th:text="${pedido.tipoTarjeta}"></span><br>
    Titular: <span th:text="${pedido.titularTarjeta}"></span><br>
    Número de tarjeta: <span th:text="${pedido.numeroTarjeta}"></span><br>
</div>

<br>

<div>
    <h3>Productos del pedido</h3>
    <div th:each="productoPedido : ${pedido.productosPedido}" style="margin: 15px">
        Nombre: <span th:text="${productoPedido.producto.nombre}"></span><br>
        Precio/unidad: <span th:text="${productoPedido.producto.precio}"></span><br>
        Cantidad: <span th:text="${productoPedido.cantidad}"></span><br>
        Medidas: <span th:text="${productoPedido.producto.medidas}"></span><br>
        Fabricante: <span th:text="${productoPedido.producto.fabricante}"></span><br>
        Material: <span th:text="${productoPedido.producto.material}"></span><br>
    </div>
</div>

<input type="hidden" id="id_pedido" th:field="${pedido.id}">

<div class="estado-box">
    Estado del pedido:<br><br>

    <select id="select_estado" th:field="${pedido.estado}">
        <option th:each="e : ${estados}" 
                th:text="${e.value}" 
                th:value="${e.key}"/>
    </select>
</div>
<a th:href="@{/admin/obtenerPedidos}">← Volver al listado de pedidos</a>

<script src="../librerias_js/jquery.js"></script>
<script>
    $("#select_estado").change(function(e){
        let estado = $("#select_estado").find(":selected").val();
        let idPedido = $("#id_pedido").val();

        alert("Asignar estado: " + estado + " a la id de pedido: " + idPedido);

        $.post("pedidosREST/actualizarEstadoPedido", {
            id: idPedido,
            estado: estado
        }).done(function(res){
            alert(res);
            
            
        });
    });

</script>

</body>
</html>
